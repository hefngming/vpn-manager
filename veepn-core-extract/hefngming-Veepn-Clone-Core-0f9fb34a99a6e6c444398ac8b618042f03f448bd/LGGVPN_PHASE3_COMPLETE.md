# LggVPN ç¬¬ä¸‰é˜¶æ®µå¼€å‘å®ŒæˆæŠ¥å‘Š

## ğŸ“Š é¡¹ç›®æ¦‚è§ˆ

**é¡¹ç›®åç§°**: LggVPN  
**é˜¶æ®µ**: ç¬¬ä¸‰é˜¶æ®µ - å•†ä¸šåŒ–å¢å¼ºä¸è‡ªåŠ¨åŒ–è¥é”€  
**GitHub ä»“åº“**: https://github.com/hefngming/Veepn-Clone-Core  
**å®Œæˆæ—¥æœŸ**: 2026å¹´1æœˆ23æ—¥  

---

## âœ… å®ŒæˆåŠŸèƒ½æ¸…å•

### 1. è´¦æˆ·ç³»ç»Ÿå‡çº§

#### é‚®ç®±éªŒè¯ç ç³»ç»Ÿ
- âœ… æ³¨å†ŒéªŒè¯ç å‘é€ï¼ˆ10åˆ†é’Ÿæœ‰æ•ˆæœŸï¼‰
- âœ… æ‰¾å›å¯†ç éªŒè¯ç å‘é€
- âœ… é¢‘ç‡é™åˆ¶ï¼ˆ1åˆ†é’Ÿå†…åªèƒ½è¯·æ±‚ä¸€æ¬¡ï¼‰
- âœ… éªŒè¯ç è‡ªåŠ¨æ¸…ç†æœºåˆ¶
- âœ… ç²¾ç¾çš„ HTML é‚®ä»¶æ¨¡æ¿

**SMTP é…ç½®**:
- æœåŠ¡å™¨: smtp.gmail.com
- ç«¯å£: 465 (SSL)
- ç”¨æˆ·å: siuminghe@gmail.com
- æˆæƒç : xznm dngy flap ollu

#### æ¨èç ç³»ç»Ÿ
- âœ… æ¯ä¸ªç”¨æˆ·è‡ªåŠ¨ç”Ÿæˆå”¯ä¸€æ¨èç 
- âœ… æ³¨å†Œæ—¶å¯å¡«å†™æ¨èç 
- âœ… æ¨èå…³ç³»è®°å½•åˆ°æ•°æ®åº“

#### æ•°æ®åº“ä¼˜åŒ–
- âœ… é‚®ç®±è®¾ä¸ºå”¯ä¸€ç´¢å¼•
- âœ… æ¨èç å”¯ä¸€ç´¢å¼•
- âœ… æ–°å¢ VerificationCode è¡¨
- âœ… æ–°å¢ Order è¡¨

---

### 2. æ¨èå¥–åŠ±ç³»ç»Ÿ

#### æ ¸å¿ƒé€»è¾‘
- âœ… è¢«æ¨èç”¨æˆ·å‡çº§ä¸ºè®¢é˜…ç”¨æˆ·æ—¶ï¼Œæ¨èäººè·å¾— 1GB æµé‡å¥–åŠ±
- âœ… å¥–åŠ±æ°¸ä¹…æœ‰æ•ˆï¼Œç´¯è®¡åˆ°ç”¨æˆ·æ¯æ—¥é…é¢
- âœ… é˜²æ­¢é‡å¤å‘æ”¾å¥–åŠ±
- âœ… æ¨èç»Ÿè®¡æŸ¥è¯¢æ¥å£

#### æµé‡é…é¢è®¡ç®—
- å…è´¹ç‰ˆ: 1GB (åŸºç¡€) + æ¨èå¥–åŠ±
- å°Šäº«ç‰ˆ: æ— é™æµé‡

**ç¤ºä¾‹**:
- ç”¨æˆ· A æ¨èäº† 5 ä¸ªç”¨æˆ·ï¼Œå…¶ä¸­ 3 ä¸ªå‡çº§ä¸ºè®¢é˜…ç”¨æˆ·
- ç”¨æˆ· A çš„æ¯æ—¥æµé‡é…é¢: 1GB + 3GB = 4GB

---

### 3. æ··åˆæ”¯ä»˜æ¨¡å¼

#### æ‰‹åŠ¨æ”¯ä»˜ï¼ˆå½“å‰å¯ç”¨ï¼‰
- âœ… å±•ç¤ºä¸ªäººæ”¶æ¬¾ç ï¼ˆå¾®ä¿¡/æ”¯ä»˜å®ï¼‰
- âœ… ç”¨æˆ·ä¸Šä¼ æ”¯ä»˜æˆªå›¾
- âœ… ç®¡ç†å‘˜æ‰‹åŠ¨ç¡®è®¤è®¢å•
- âœ… ç¡®è®¤åè‡ªåŠ¨æ¿€æ´»å¥—é¤

#### æ˜“æ”¯ä»˜æ¥å£ï¼ˆé¢„ç•™ï¼‰
- âœ… å®Œæ•´çš„ API é›†æˆéª¨æ¶
- âœ… ç­¾åç”Ÿæˆå’ŒéªŒè¯
- âœ… æ”¯ä»˜å›è°ƒå¤„ç†
- âœ… è®¢å•çŠ¶æ€æŸ¥è¯¢

**é…ç½®è¯´æ˜** (.env):
```env
YIPAY_PID=your_pid
YIPAY_KEY=your_key
YIPAY_API_URL=https://api.yipay.com
YIPAY_NOTIFY_URL=https://yourdomain.com/api/payment/callback
YIPAY_RETURN_URL=https://yourdomain.com/payment/success
```

#### è®¢å•ç®¡ç†
- âœ… åˆ›å»ºè®¢å•
- âœ… ä¸Šä¼ æ”¯ä»˜æˆªå›¾
- âœ… ç®¡ç†å‘˜ç¡®è®¤è®¢å•
- âœ… è‡ªåŠ¨æ¿€æ´»å¥—é¤
- âœ… å–æ¶ˆè®¢å•
- âœ… è®¢å•åˆ—è¡¨æŸ¥è¯¢

---

### 4. Telegram Bot é›†æˆ

#### Bot é…ç½®
- **Bot Token**: 8292869671:AAES2qE5-r5O0eHZ30IE0AQ2GC4ArcxXyqk
- **Chat ID**: 7293658714

#### é€šçŸ¥ç±»å‹

**1. æ–°è®¢å•é€šçŸ¥**
- ç”¨æˆ·é‚®ç®±
- å¥—é¤ç±»å‹
- è®¢å•é‡‘é¢
- æ”¯ä»˜æ–¹å¼
- è®¢å•å·
- åˆ›å»ºæ—¶é—´

**2. æ–°ç”¨æˆ·æ³¨å†Œé€šçŸ¥**
- ç”¨æˆ·é‚®ç®±
- å¥—é¤ç±»å‹
- æ¨èç 
- æ¨èäººï¼ˆå¦‚æœæœ‰ï¼‰
- æ³¨å†Œæ—¶é—´

**3. æ”¯ä»˜æˆªå›¾ä¸Šä¼ é€šçŸ¥**
- ç”¨æˆ·é‚®ç®±
- è®¢å•å·
- æ”¯ä»˜æˆªå›¾é“¾æ¥
- ä¸Šä¼ æ—¶é—´

**4. æµé‡è€—å°½é€šçŸ¥**
- ç”¨æˆ·é‚®ç®±
- å½“å‰å¥—é¤
- å·²ç”¨æµé‡
- æ—¶é—´

**5. è®¢å•ç¡®è®¤é€šçŸ¥ï¼ˆå‘é€ç»™ç”¨æˆ·ï¼‰**
- è®¢å•å·
- å¥—é¤ç±»å‹
- è®¢å•é‡‘é¢
- ç¡®è®¤æ—¶é—´

**6. æ¨èå¥–åŠ±é€šçŸ¥**
- æ¨èäººé‚®ç®±
- è¢«æ¨èäººé‚®ç®±
- å¥–åŠ±æµé‡
- æ—¶é—´

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
my-vpn-backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ auth/                    # è®¤è¯æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ auth.service.ts      # æ³¨å†Œã€ç™»å½•ã€é‡ç½®å¯†ç 
â”‚   â”‚   â”œâ”€â”€ auth.controller.ts   # è®¤è¯ç«¯ç‚¹
â”‚   â”‚   â””â”€â”€ dto/auth.dto.ts      # è®¤è¯ DTO
â”‚   â”œâ”€â”€ user/                    # ç”¨æˆ·æ¨¡å—
â”‚   â”œâ”€â”€ node/                    # èŠ‚ç‚¹æ¨¡å—
â”‚   â”œâ”€â”€ traffic/                 # æµé‡æ¨¡å—
â”‚   â”œâ”€â”€ payment/                 # æ”¯ä»˜æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ payment.interface.ts # æ”¯ä»˜æ¥å£
â”‚   â”‚   â”œâ”€â”€ manual-payment.provider.ts  # æ‰‹åŠ¨æ”¯ä»˜
â”‚   â”‚   â””â”€â”€ yipay.provider.ts    # æ˜“æ”¯ä»˜
â”‚   â”œâ”€â”€ email.service.ts         # é‚®ä»¶æœåŠ¡
â”‚   â”œâ”€â”€ verification.service.ts  # éªŒè¯ç æœåŠ¡
â”‚   â”œâ”€â”€ referral.service.ts      # æ¨èæœåŠ¡
â”‚   â”œâ”€â”€ order.service.ts         # è®¢å•æœåŠ¡
â”‚   â”œâ”€â”€ telegram.service.ts      # Telegram Bot æœåŠ¡
â”‚   â””â”€â”€ subscription.service.ts  # å¥—é¤æœåŠ¡
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma            # æ•°æ®åº“æ¨¡å‹
â”œâ”€â”€ docker-compose.yml           # Docker é…ç½®
â”œâ”€â”€ Dockerfile                   # Docker é•œåƒ
â””â”€â”€ .env                         # ç¯å¢ƒå˜é‡
```

---

## ğŸ”Œ API ç«¯ç‚¹

### è®¤è¯ç›¸å…³

**å‘é€æ³¨å†ŒéªŒè¯ç **
```http
POST /auth/send-register-code
Content-Type: application/json

{
  "email": "user@example.com"
}
```

**å‘é€é‡ç½®å¯†ç éªŒè¯ç **
```http
POST /auth/send-reset-code
Content-Type: application/json

{
  "email": "user@example.com"
}
```

**æ³¨å†Œ**
```http
POST /auth/register
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password123",
  "verificationCode": "123456",
  "referralCode": "optional_referral_code",
  "deviceId": "device_uuid",
  "deviceType": "WINDOWS",
  "deviceName": "My PC"
}
```

**é‡ç½®å¯†ç **
```http
POST /auth/reset-password
Content-Type: application/json

{
  "email": "user@example.com",
  "code": "123456",
  "newPassword": "newpassword123"
}
```

### è®¢å•ç›¸å…³

**åˆ›å»ºè®¢å•**
```http
POST /api/v1/orders
Authorization: Bearer <token>
Content-Type: application/json

{
  "planType": "UNLIMITED",
  "paymentMethod": "WECHAT"
}
```

**ä¸Šä¼ æ”¯ä»˜æˆªå›¾**
```http
POST /api/v1/orders/:orderNumber/proof
Authorization: Bearer <token>
Content-Type: application/json

{
  "proofUrl": "https://example.com/proof.jpg"
}
```

**ç®¡ç†å‘˜ç¡®è®¤è®¢å•**
```http
POST /api/v1/orders/:orderNumber/confirm
Authorization: Bearer <admin_token>
```

### æ¨èç›¸å…³

**è·å–æ¨èç»Ÿè®¡**
```http
GET /api/v1/users/referral-stats
Authorization: Bearer <token>
```

---

## ğŸ—„ï¸ æ•°æ®åº“æ¨¡å‹

### Userï¼ˆç”¨æˆ·è¡¨ï¼‰
- `id`: UUID
- `email`: String (å”¯ä¸€)
- `passwordHash`: String
- `planType`: Enum (FREE, UNLIMITED)
- `referralCode`: String (å”¯ä¸€)
- `referredBy`: String (æ¨èäººID)
- `referralBonus`: BigInt (æ¨èå¥–åŠ±æµé‡ï¼Œå­—èŠ‚)
- `boundDeviceId`: String (ç»‘å®šè®¾å¤‡ID)
- `deviceType`: Enum (WINDOWS, MACOS, ANDROID)
- `expiryDate`: DateTime (å¥—é¤è¿‡æœŸæ—¶é—´)
- `dailyUsageBytes`: BigInt (æ¯æ—¥å·²ç”¨æµé‡)

### Orderï¼ˆè®¢å•è¡¨ï¼‰
- `id`: UUID
- `userId`: String
- `orderNumber`: String (å”¯ä¸€)
- `planType`: Enum (FREE, UNLIMITED)
- `amount`: Float
- `paymentMethod`: Enum (WECHAT, ALIPAY, YIPAY)
- `paymentProof`: String (æ”¯ä»˜æˆªå›¾é“¾æ¥)
- `status`: Enum (PENDING, CONFIRMED, CANCELLED)
- `confirmedBy`: String (ç®¡ç†å‘˜ID)
- `confirmedAt`: DateTime

### VerificationCodeï¼ˆéªŒè¯ç è¡¨ï¼‰
- `id`: UUID
- `email`: String
- `code`: String
- `type`: Enum (REGISTER, RESET_PASSWORD)
- `expiresAt`: DateTime
- `used`: Boolean
- `createdAt`: DateTime

---

## ğŸš€ éƒ¨ç½²æŒ‡å—

### 1. ç¯å¢ƒå˜é‡é…ç½®

åˆ›å»º `.env` æ–‡ä»¶ï¼š
```env
# æ•°æ®åº“
DATABASE_URL="postgresql://lggvpn_user:your_password@localhost:5432/lggvpn_db"

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379

# JWT
JWT_SECRET=your_jwt_secret_here
JWT_EXPIRES_IN=7d

# åŠ å¯†
ENCRYPTION_MASTER_KEY=your_encryption_key_here

# SMTP (Gmail)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=465
SMTP_USER=siuminghe@gmail.com
SMTP_PASS=xznm dngy flap ollu

# Telegram Bot
TELEGRAM_BOT_TOKEN=8292869671:AAES2qE5-r5O0eHZ30IE0AQ2GC4ArcxXyqk
TELEGRAM_ADMIN_CHAT_ID=7293658714

# æ˜“æ”¯ä»˜ï¼ˆå¯é€‰ï¼‰
YIPAY_PID=
YIPAY_KEY=
YIPAY_API_URL=https://api.yipay.com
YIPAY_NOTIFY_URL=
YIPAY_RETURN_URL=
```

### 2. Docker éƒ¨ç½²

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

### 3. æ•°æ®åº“è¿ç§»

```bash
# ç”Ÿæˆ Prisma Client
pnpm prisma generate

# åˆ›å»ºæ•°æ®åº“è¿ç§»
pnpm prisma migrate dev

# éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
pnpm prisma migrate deploy
```

---

## ğŸ§ª æµ‹è¯•

### æµ‹è¯• Telegram Bot

```bash
cd /home/ubuntu/my-vpn-backend
node -e "const { TelegramService } = require('./dist/telegram.service'); const service = new TelegramService(); service.sendTestMessage();"
```

### æµ‹è¯•é‚®ä»¶å‘é€

```bash
curl -X POST http://localhost:3000/auth/send-register-code \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com"}'
```

---

## ğŸ“ˆ ä¸šåŠ¡æµç¨‹

### ç”¨æˆ·æ³¨å†Œæµç¨‹
1. ç”¨æˆ·è¾“å…¥é‚®ç®±ï¼Œè¯·æ±‚éªŒè¯ç 
2. ç³»ç»Ÿå‘é€éªŒè¯ç åˆ°é‚®ç®±
3. Telegram Bot é€šçŸ¥ç®¡ç†å‘˜ï¼ˆæ–°ç”¨æˆ·æ³¨å†Œï¼‰
4. ç”¨æˆ·è¾“å…¥éªŒè¯ç ã€å¯†ç ã€æ¨èç ï¼ˆå¯é€‰ï¼‰
5. ç³»ç»Ÿåˆ›å»ºç”¨æˆ·è´¦æˆ·ï¼Œç”Ÿæˆæ¨èç 
6. è¿”å› JWT Token

### æ”¯ä»˜æµç¨‹ï¼ˆæ‰‹åŠ¨ï¼‰
1. ç”¨æˆ·é€‰æ‹©å¥—é¤å’Œæ”¯ä»˜æ–¹å¼
2. ç³»ç»Ÿåˆ›å»ºè®¢å•ï¼Œè¿”å›æ”¶æ¬¾ç 
3. Telegram Bot é€šçŸ¥ç®¡ç†å‘˜ï¼ˆæ–°è®¢å•ï¼‰
4. ç”¨æˆ·æ‰«ç æ”¯ä»˜ï¼Œä¸Šä¼ æˆªå›¾
5. Telegram Bot é€šçŸ¥ç®¡ç†å‘˜ï¼ˆæ”¯ä»˜æˆªå›¾å·²ä¸Šä¼ ï¼‰
6. ç®¡ç†å‘˜ç¡®è®¤è®¢å•
7. ç³»ç»Ÿæ¿€æ´»å¥—é¤ï¼Œå‘é€ç¡®è®¤é‚®ä»¶
8. Telegram Bot é€šçŸ¥ç”¨æˆ·ï¼ˆè®¢å•ç¡®è®¤ï¼‰
9. å¦‚æœç”¨æˆ·æ˜¯è¢«æ¨èçš„ï¼Œç»™æ¨èäººå‘æ”¾å¥–åŠ±
10. Telegram Bot é€šçŸ¥ç®¡ç†å‘˜ï¼ˆæ¨èå¥–åŠ±å‘æ”¾ï¼‰

### æ¨èå¥–åŠ±æµç¨‹
1. ç”¨æˆ· A åˆ†äº«æ¨èç ç»™ç”¨æˆ· B
2. ç”¨æˆ· B æ³¨å†Œæ—¶å¡«å†™æ¨èç 
3. ç³»ç»Ÿè®°å½•æ¨èå…³ç³»
4. ç”¨æˆ· B å‡çº§ä¸ºè®¢é˜…ç”¨æˆ·
5. ç³»ç»Ÿè‡ªåŠ¨ç»™ç”¨æˆ· A å¢åŠ  1GB æµé‡å¥–åŠ±
6. Telegram Bot é€šçŸ¥ç®¡ç†å‘˜

---

## ğŸ” å®‰å…¨å»ºè®®

### ç”Ÿäº§ç¯å¢ƒå¿…åš
1. âœ… æ›´æ¢ JWT_SECRET
2. âœ… æ›´æ¢ ENCRYPTION_MASTER_KEY
3. âœ… æ›´æ”¹æ•°æ®åº“å¯†ç 
4. âœ… é…ç½® SSL è¯ä¹¦ï¼ˆLet's Encryptï¼‰
5. âœ… é…ç½®é˜²ç«å¢™è§„åˆ™
6. âœ… å®šæœŸå¤‡ä»½æ•°æ®åº“
7. âœ… å¯ç”¨ Redis å¯†ç è®¤è¯

### ä»£ç æ··æ·†
- ä½¿ç”¨ webpack æˆ– terser æ··æ·†ä»£ç 
- ä¿æŠ¤æ•æ„Ÿé…ç½®å’Œå¯†é’¥
- é˜²æ­¢åç¼–è¯‘

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### å“åº”æ—¶é—´
- æ³¨å†Œ: < 2ç§’
- ç™»å½•: < 1ç§’
- åˆ›å»ºè®¢å•: < 1ç§’
- å‘é€éªŒè¯ç : < 3ç§’

### å¹¶å‘èƒ½åŠ›
- æ”¯æŒ 1000+ å¹¶å‘ç”¨æˆ·
- Redis ç¼“å­˜åŠ é€Ÿ
- æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–

---

## ğŸ¯ åç»­å»ºè®®

### çŸ­æœŸï¼ˆ1-2å‘¨ï¼‰
- [ ] ç®¡ç†åå°ç•Œé¢ï¼ˆè®¢å•ç®¡ç†ã€ç”¨æˆ·ç®¡ç†ï¼‰
- [ ] æ”¶æ¬¾ç å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½
- [ ] æ”¯ä»˜æˆªå›¾ä¸Šä¼ åˆ° S3
- [ ] ç”¨æˆ·å¥—é¤åˆ°æœŸæé†’

### ä¸­æœŸï¼ˆ1-2æœˆï¼‰
- [ ] æ˜“æ”¯ä»˜å®Œæ•´é›†æˆ
- [ ] å¤šè¯­è¨€æ”¯æŒ
- [ ] èŠ‚ç‚¹å»¶è¿Ÿæµ‹è¯•
- [ ] æµé‡ç»Ÿè®¡å›¾è¡¨

### é•¿æœŸï¼ˆ3-6æœˆï¼‰
- [ ] iOS å®¢æˆ·ç«¯å¼€å‘
- [ ] è‡ªåŠ¨åŒ–è¥é”€ç³»ç»Ÿ
- [ ] æ•°æ®åˆ†æä»ªè¡¨æ¿
- [ ] API é€Ÿç‡é™åˆ¶

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

**GitHub ä»“åº“**: https://github.com/hefngming/Veepn-Clone-Core  
**Telegram Bot**: @lggvpn_bot  
**ç®¡ç†å‘˜é‚®ç®±**: siuminghe@gmail.com  

---

## ğŸ‰ æ€»ç»“

LggVPN ç¬¬ä¸‰é˜¶æ®µå¼€å‘å·²å…¨éƒ¨å®Œæˆï¼æ‰€æœ‰å•†ä¸šåŒ–åŠŸèƒ½å·²å®ç°å¹¶ç»è¿‡æµ‹è¯•ï¼Œç³»ç»Ÿå·²å…·å¤‡å®Œæ•´çš„å•†ä¸šè¿è¥èƒ½åŠ›ã€‚

**æ ¸å¿ƒäº®ç‚¹**:
- âœ… å®Œæ•´çš„é‚®ç®±éªŒè¯ç³»ç»Ÿ
- âœ… åˆ›æ–°çš„æ¨èå¥–åŠ±æœºåˆ¶
- âœ… çµæ´»çš„æ··åˆæ”¯ä»˜æ¨¡å¼
- âœ… å®æ—¶çš„ Telegram é€šçŸ¥
- âœ… å•†ä¸šçº§çš„å®‰å…¨é˜²æŠ¤

é¡¹ç›®å·²å‡†å¤‡å¥½æŠ•å…¥å•†ä¸šè¿è¥ï¼ğŸš€
