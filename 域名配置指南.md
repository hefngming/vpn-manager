# LogVPN 域名配置指南

## 域名信息
- **域名**: dj.siumingho.dpdns.org
- **指向IP**: 155.94.160.248
- **用途**: LogVPN Web访问入口

---

## 配置步骤

### 1. 域名DNS配置

在你的域名提供商（如DPDNS）管理面板中：

**A记录配置**:
```
主机记录: @ 或 dj
记录类型: A
记录值: 155.94.160.248
TTL: 600 (10分钟)
```

**CNAME配置** (可选，用于www子域名):
```
主机记录: www
记录类型: CNAME
记录值: dj.siumingho.dpdns.org
TTL: 600
```

### 2. 等待DNS生效

DNS传播时间通常为10分钟到48小时，取决于TTL设置。

**检查DNS是否生效**:
```bash
nslookup dj.siumingho.dpdns.org
# 或
dig dj.siumingho.dpdns.org
```

### 3. Nginx配置域名

SSH登录服务器并编辑Nginx配置：

```bash
ssh root@155.94.160.248
nano /etc/nginx/sites-available/default
```

添加或修改server_name:
```nginx
server {
    listen 80;
    server_name dj.siumingho.dpdns.org 155.94.160.248;
    
    # 前端静态文件
    location / {
        root /var/www/html;
        try_files $uri $uri/ /index.html;
    }
    
    # 后端API反向代理
    location /api/ {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

测试并重载Nginx:
```bash
nginx -t
nginx -s reload
```

### 4. 验证配置

**测试域名访问**:
```bash
curl http://dj.siumingho.dpdns.org
curl http://dj.siumingho.dpdns.org/api/health
```

---

## 最终访问地址

| 服务 | 域名地址 | IP地址 (备用) |
|------|----------|---------------|
| **Web前端** | http://dj.siumingho.dpdns.org | http://155.94.160.248 |
| **API接口** | http://dj.siumingho.dpdns.org/api | http://155.94.160.248/api |
| **健康检查** | http://dj.siumingho.dpdns.org/api/health | http://155.94.160.248/api/health |

---

## 安全提示

### 隐藏IP信息
- 所有前端代码中不应该直接暴露IP地址
- 使用域名进行所有API调用
- 配置文件中使用域名而非IP

### 后续HTTPS配置
建议配置SSL证书启用HTTPS：
```bash
# 使用Certbot申请Let's Encrypt证书
certbot --nginx -d dj.siumingho.dpdns.org
```

---

## 故障排查

### DNS不生效
1. 检查DNS记录是否正确添加
2. 清除本地DNS缓存: `ipconfig /flushdns` (Windows)
3. 使用公共DNS服务器: 8.8.8.8, 114.114.114.114

### Nginx配置错误
1. 检查配置文件语法: `nginx -t`
2. 查看错误日志: `tail -f /var/log/nginx/error.log`
3. 确认server_name包含域名

### 访问被拒绝
1. 检查防火墙设置
2. 确认端口80开放
3. 检查SELinux/AppArmor设置

---

## 完成检查清单

- [ ] DNS A记录已配置
- [ ] DNS已生效 (nslookup返回正确IP)
- [ ] Nginx server_name已更新
- [ ] Nginx配置测试通过
- [ ] 域名可正常访问
- [ ] API接口可正常访问
- [ ] 所有功能测试通过

---

**配置完成后，用户将通过 http://dj.siumingho.dpdns.org 访问LogVPN，不再直接暴露IP地址！**
