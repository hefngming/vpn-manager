# ğŸ¦ å°é¾™è™¾VPN - å®¢æˆ·ç«¯å¼€å‘æŒ‡å—

## åŠ é€Ÿå™¨æ¨¡å¼æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   VPN å®¢æˆ·ç«¯     â”‚ â”€â”€â”€â–¶ â”‚   åç«¯ API      â”‚ â”€â”€â”€â–¶ â”‚   æ•°æ®åº“        â”‚
â”‚  (Electron/ç§»åŠ¨ç«¯)â”‚      â”‚  (Node.js)      â”‚      â”‚  (SQLite/PostgreSQL)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                         â”‚
         â”‚ 1. ç™»å½•è·å– Token        â”‚
         â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
         â”‚                         â”‚
         â”‚ 2. è·å–èŠ‚ç‚¹åˆ—è¡¨ (æ— é…ç½®)  â”‚
         â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
         â”‚                         â”‚
         â”‚ 3. é€‰æ‹©èŠ‚ç‚¹ï¼Œè¯·æ±‚é…ç½®     â”‚
         â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
         â”‚                         â”‚
         â”‚ 4. è¿”å›åŠ å¯†é…ç½®          â”‚
         â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
         â”‚                         â”‚
         â”‚ 5. å®¢æˆ·ç«¯è§£å¯†å¹¶å»ºç«‹è¿æ¥   â”‚
         â”‚    (Shadowsocks/V2Rayç­‰) â”‚
```

## API ç«¯ç‚¹

### 1. è·å–èŠ‚ç‚¹åˆ—è¡¨ (æ— é…ç½®)
```
GET /api/client/nodes
Authorization: Bearer {token}
```

è¿”å›ï¼š
```json
{
  "user": {
    "email": "user@example.com",
    "planType": "FREE",
    "dailyUsage": "1000000",
    "dailyLimit": 1073741824,
    "remainingBytes": 1072741824
  },
  "nodes": [
    {
      "id": "node-uuid",
      "displayName": "é¦™æ¸¯èŠ‚ç‚¹ 01",
      "countryCode": "HK",
      "tier": "FREE",
      "latency": 45,
      "load": 30
    }
  ]
}
```

### 2. è¿æ¥èŠ‚ç‚¹ (è·å–åŠ å¯†é…ç½®)
```
POST /api/client/connect
Authorization: Bearer {token}
Content-Type: application/json

{
  "nodeId": "node-uuid"
}
```

è¿”å›ï¼š
```json
{
  "success": true,
  "node": {
    "id": "node-uuid",
    "name": "é¦™æ¸¯èŠ‚ç‚¹ 01",
    "countryCode": "HK"
  },
  "config": {
    "server": "hk.example.com",
    "port": 443,
    "method": "aes-256-gcm",
    "password": "encrypted-password",
    "type": "ss",
    "_meta": {
      "userId": "user-uuid",
      "connectedAt": "2024-01-01T00:00:00Z"
    }
  },
  "limits": {
    "dailyUsage": 1000000,
    "dailyLimit": 1073741824
  }
}
```

### 3. è·å– Clash è®¢é˜…é…ç½®
```
GET /api/client/subscription-config
Authorization: Bearer {token}
```

è¿”å› Clash YAML é…ç½®æ–‡ä»¶

## å®¢æˆ·ç«¯å¼€å‘å»ºè®®

### æŠ€æœ¯æ ˆé€‰æ‹©

**æ¡Œé¢ç«¯:**
- Electron + React/Vue
- Tauri + Rust
- Flutter Desktop

**ç§»åŠ¨ç«¯:**
- Flutter
- React Native
- Swift (iOS) / Kotlin (Android)

### æ ¸å¿ƒåŠŸèƒ½

1. **ç”¨æˆ·è®¤è¯**
   - ç™»å½•/æ³¨å†Œç•Œé¢
   - Token æœ¬åœ°å­˜å‚¨
   - è‡ªåŠ¨ç™»å½•

2. **èŠ‚ç‚¹é€‰æ‹©ç•Œé¢**
   - æ˜¾ç¤ºèŠ‚ç‚¹åˆ—è¡¨ (åç§°ã€å»¶è¿Ÿã€è´Ÿè½½)
   - å»¶è¿Ÿæµ‹è¯• (ping)
   - æ™ºèƒ½æ¨è (æœ€ä½å»¶è¿Ÿ)

3. **è¿æ¥ç®¡ç†**
   - ä¸€é”®è¿æ¥/æ–­å¼€
   - è¿æ¥çŠ¶æ€æ˜¾ç¤º
   - å®æ—¶æµé‡ç»Ÿè®¡

4. **ç³»ç»Ÿä»£ç†**
   - Windows: ä¿®æ”¹ç³»ç»Ÿä»£ç†è®¾ç½®
   - macOS: networksetup å‘½ä»¤
   - Linux: gsettings æˆ–ç›´æ¥ä¿®æ”¹ç¯å¢ƒå˜é‡
   - æˆ–å¯åŠ¨æœ¬åœ°ä»£ç†æœåŠ¡å™¨ (å¦‚ Clash)

### é…ç½®è§£å¯†

åç«¯è¿”å›çš„é…ç½®å·²ç»æ˜¯è§£å¯†åçš„æ˜æ–‡ï¼ˆç”±æœåŠ¡å™¨è§£å¯†ï¼‰ï¼Œå®¢æˆ·ç«¯å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š

```python
config = response.json()['config']

# ç›´æ¥ä½¿ç”¨é…ç½®å»ºç«‹è¿æ¥
if config['type'] == 'ss':
    # ä½¿ç”¨ shadowsocks åº“
    import shadowsocks
    shadowsocks.connect(
        server=config['server'],
        port=config['port'],
        method=config['method'],
        password=config['password']
    )
```

### æµé‡ç»Ÿè®¡ä¸ŠæŠ¥

å®¢æˆ·ç«¯éœ€è¦å®šæœŸä¸ŠæŠ¥æµé‡ä½¿ç”¨æƒ…å†µï¼š

```
POST /api/traffic/report
Authorization: Bearer {token}
Content-Type: application/json

{
  "usageBytes": 1024000
}
```

å»ºè®®æ¯ 60 ç§’ä¸ŠæŠ¥ä¸€æ¬¡ï¼Œé¿å…è¶…å‡ºé™åˆ¶ã€‚

## ç¤ºä¾‹å®¢æˆ·ç«¯

è§ `vpn_client.py` - ä¸€ä¸ªå‘½ä»¤è¡Œç¤ºä¾‹ï¼Œæ¼”ç¤ºå®Œæ•´æµç¨‹ã€‚

## å®‰å…¨å»ºè®®

1. **Token å­˜å‚¨**: ä½¿ç”¨ç³»ç»Ÿå¯†é’¥é“¾å­˜å‚¨ Token
   - Windows: Windows Credential Manager
   - macOS: Keychain
   - Linux: libsecret

2. **é…ç½®åŠ å¯†**: è™½ç„¶åç«¯è¿”å›çš„é…ç½®æ˜¯æ˜æ–‡ï¼Œä½†å®¢æˆ·ç«¯åº”è¯¥ï¼š
   - ä¸åœ¨æ—¥å¿—ä¸­è®°å½•æ•æ„Ÿä¿¡æ¯
   - å†…å­˜ä¸­åŠæ—¶æ¸…ç†é…ç½®
   - é…ç½®æ–‡ä»¶ï¼ˆå¦‚æœ‰ï¼‰æœ¬åœ°åŠ å¯†å­˜å‚¨

3. **è¯ä¹¦æ ¡éªŒ**: ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨ HTTPSï¼Œå¹¶æ ¡éªŒæœåŠ¡å™¨è¯ä¹¦

## å‘å¸ƒéƒ¨ç½²

### Web ç‰ˆæœ¬
å½“å‰å‰ç«¯å·²ç»æä¾› Web ç‰ˆæœ¬ï¼Œé€‚åˆä½œä¸ºç®¡ç†ç•Œé¢ï¼š
- æŸ¥çœ‹æµé‡ä½¿ç”¨æƒ…å†µ
- ç®¡ç†èŠ‚ç‚¹ (ç®¡ç†å‘˜)
- ç”Ÿæˆè®¢é˜…é“¾æ¥ä¾›ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯ä½¿ç”¨

### æ¡Œé¢å®¢æˆ·ç«¯
1. åŸºäº Electron åŒ…è£… Web å‰ç«¯
2. æ·»åŠ æœ¬åœ°ä»£ç†åŠŸèƒ½ (é›†æˆ Clash æ ¸å¿ƒ)
3. æ‰“åŒ…å‘å¸ƒ

### ç§»åŠ¨å®¢æˆ·ç«¯
1. ä½¿ç”¨ Flutter å¼€å‘
2. é›†æˆ shadowsocks-libev æˆ– v2ray-core
3. é€šè¿‡ TestFlight / Google Play åˆ†å‘
